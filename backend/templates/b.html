<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<link rel="stylesheet" href="/static/styles.css">
	</head>
	<body>
		<div class="container">
			<div class="form">
				<h3>Users form</h3>
				<label class="input">
					<label for="username"><i class="fa-solid fa-user fa-2xs"></i></label>
					<input type="text" id="username">
				</label>
				<label class="input">
					<label for="password"><i class="fa-solid fa-lock fa-2xs"></i></label>
					<input type="password" id="password">
				</label>
				<label class="input" id="confirmPassword">
					<label for="password1"><i class="fa-solid fa-check fa-2xs"></i></label>
					<input type="password" id="password1">
				</label>
				<button id="proceed">Register</button>
			</div>
		</div>
	</body>
	<script>
		const username = document.getElementById("username")
		const button = document.getElementById("confirmPassword")
		username.onchange = (event) => {
			fetch("/api/confirm-user", {
				"method": "POST",
				"body": JSON.stringify({
					"username": username.value
				})
			}).then(r => {
				return r.json()
			}).then(r => {
				if(r.total > 0){
					button.style.display = "none"
					document.getElementById("proceed").textContent = "Login"
				}else{
					button.style.display = "flex"
					document.getElementById("proceed").textContent = "Register"
				}
			}).catch(e => {
				alert(e)
			})
		}
		button.onclick = (event) => {
			fetch("/api/credentials", {
				"method": "POST",
				"body": JSON.stringify({
					"username": username.value,
					"password": document.getElementById("password").value,
					"password1": document.getElementById("password1").value
				})
			}).then(r => {
				return r.json()
			}).then(r => {
				alert(JSON.stringify(r))
			})
		}
	</script>
</html>